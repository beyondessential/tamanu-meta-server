<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Production Server Versions - Tamanu</title>
	<style>
		:root {
			--color-text-primary: #1a1a1a;
			--color-text-secondary: #4a4a4a;
			--color-text-light: #6a6a6a;
			--color-bg-white: #ffffff;
			--color-bg-light: #f5f5f5;
			--color-border-light: #e0e0e0;
			--color-primary: #0066cc;
			--color-success-status: #28a745;
			--color-error: #dc3545;
			--color-warning: #ffc107;
			--color-status-gone: #6c757d;
		}

		* {
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			margin: 0;
			padding: 20px;
			background: var(--color-bg-light);
			color: var(--color-text-primary);
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
		}

		.page-header {
			margin-bottom: 2em;
		}

		h1 {
			font-size: 2em;
			color: var(--color-text-primary);
			margin-bottom: 0.5em;
			font-weight: 500;
		}

		.servers-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(min(20em, 95vw), 1fr));
			gap: 0.75em;
		}

		.server-card {
			background: var(--color-bg-white);
			border: 1px solid var(--color-border-light);
			border-radius: 6px;
			padding: 0.75em 1em;
			text-decoration: none;
			display: grid;
			gap: 0.75em;
			min-height: 3em;
			grid-template-areas: "host name version";
			grid-template-rows: auto;
			grid-template-columns: auto 1fr auto;
		}

		.host-link {
			grid-area: host;
			font-size: 1em;
			text-decoration: none;
			color: var(--color-text-secondary);
			transition: color 0.2s;
			flex-shrink: 0;
			line-height: 1;
			display: flex;
			align-items: center;
		}

		.server-name {
			grid-area: name;
			font-size: 1.1em;
			color: var(--color-text-primary);
			margin: 0;
			font-weight: 500;
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			text-align: left;
		}

		.version-container {
			grid-area: version;
			flex-shrink: 0;
			display: flex;
			align-items: center;
			color: var(--color-text-secondary);
		}

		.version-display {
			display: flex;
			align-items: center;
			gap: 0.5em;
		}

		.version-text {
			font-family: monospace, monospace;
			font-size: 0.9em;
			font-weight: bold;
		}

		.version-indicator {
			width: 0.75em;
			height: 0.75em;
			display: inline-block;
			flex-shrink: 0;
		}

		.version-up-to-date {
			background: var(--color-success-status);
		}

		.version-okay {
			background: #17a2b8;
		}

		.version-outdated {
			background: var(--color-warning);
		}

		.version-very-outdated {
			background: var(--color-error);
		}

		.version-unknown {
			background: var(--color-status-gone);
			opacity: 0.5;
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="page-header">
			<h1>Production Server Versions</h1>
			<p>Latest version: <span class="version-text">{{ latest_version }}</span></p>
		</div>
		<div class="servers-grid">
			{% for server in servers %}
			<div class="server-card">
				<a href="{{ server.host }}" class="host-link" target="_blank" title="{{ server.host }}">üåê</a>
				<h3 class="server-name">{{ server.name }}</h3>
				{% if server.version %}
				<div class="version-container">
					<span class="version-display">
						<span class="version-text">{{ server.version }}</span>
						{% if server.version_distance == 0 %}
							<span class="version-indicator version-up-to-date" title="Up to date"></span>
						{% elif server.version_distance < 2 %}
							<span class="version-indicator version-up-to-date" title="{{ server.version_distance }} versions behind"></span>
						{% elif server.version_distance < 5 %}
							<span class="version-indicator version-okay" title="{{ server.version_distance }} versions behind"></span>
						{% elif server.version_distance < 10 %}
							<span class="version-indicator version-outdated" title="{{ server.version_distance }} versions behind"></span>
						{% else %}
							<span class="version-indicator version-very-outdated" title="{{ server.version_distance }} versions behind"></span>
						{% endif %}
					</span>
				</div>
				{% else %}
				<div class="version-container">
					<span class="version-display">
					  <span class="version-text">Version unknown</span>
					</span>
				</div>
				{% endif %}
			</div>
			{% endfor %}
		</div>
	</div>
</body>
</html>
