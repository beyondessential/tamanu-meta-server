<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg" />
	<title>Production Server Versions - Tamanu</title>
	<style>
		:root {
			--color-text-primary: #1a1a1a;
			--color-text-secondary: #4a4a4a;
			--color-text-light: #6a6a6a;
			--color-bg-white: #ffffff;
			--color-bg-light: #f5f5f5;
			--color-border-light: #e0e0e0;
			--color-primary: #0066cc;
			--color-success-status: #28a745;
			--color-error: #dc3545;
			--color-warning: #ffc107;
			--color-status-gone: #6c757d;
		}

		* {
			box-sizing: border-box;
		}

		body {
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			margin: 0;
			padding: 20px;
			background: var(--color-bg-light);
			color: var(--color-text-primary);
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
		}

		.page-header {
			margin-bottom: 2em;
		}

		h1 {
			font-size: 2em;
			color: var(--color-text-primary);
			margin-bottom: 0.5em;
			font-weight: 500;
		}

		.servers-grid {
			display: grid;
			grid-template-columns: repeat(auto-fill, minmax(min(20em, 95vw), 1fr));
			gap: 0.75em;
		}

		.server-card {
			background: var(--color-bg-white);
			border: 1px solid var(--color-border-light);
			border-radius: 6px;
			padding: 0.75em 1em;
			text-decoration: none;
			display: grid;
			gap: 0.75em;
			min-height: 3em;
			grid-template-areas: "host name version";
			grid-template-rows: auto;
			grid-template-columns: auto 1fr auto;
		}

		.rc-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(min(12em, 95vw), 1fr));
			gap: 1em;
			margin-bottom: 2em;
		}

		.rc-column {
			display: flex;
			flex-direction: column;
			gap: 0.5em;
		}

		.rc-column-header {
			font-size: 1.3em;
			font-weight: 500;
			color: var(--color-text-primary);
			text-align: center;
			margin-bottom: 0.5em;
		}

		.rc-card {
			background: var(--color-bg-white);
			border: 1px solid var(--color-border-light);
			border-radius: 6px;
			padding: 0.75em 1em;
			text-decoration: none;
			display: block;
			color: var(--color-text-primary);
			transition: all 0.2s;
			text-align: center;
			min-height: 3em;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.rc-card:hover {
			background: var(--color-bg-light);
			border-color: var(--color-primary);
			transform: translateY(-2px);
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.host-link {
			grid-area: host;
			font-size: 1em;
			text-decoration: none;
			color: var(--color-text-secondary);
			transition: color 0.2s;
			flex-shrink: 0;
			line-height: 1;
			display: flex;
			align-items: center;
		}

		.server-name {
			grid-area: name;
			font-size: 1.1em;
			color: var(--color-text-primary);
			margin: 0;
			font-weight: 500;
			flex: 1;
			min-width: 0;
			overflow: hidden;
			text-overflow: ellipsis;
			white-space: nowrap;
			text-align: left;
		}

		.version-container {
			grid-area: version;
			flex-shrink: 0;
			display: flex;
			align-items: center;
			color: var(--color-text-secondary);
		}

		.version-display {
			display: flex;
			align-items: center;
			gap: 0.5em;
		}

		.version-text {
			font-family: monospace, monospace;
			font-size: 0.9em;
			font-weight: bold;
		}

		.version-indicator {
			width: 0.75em;
			height: 0.75em;
			display: inline-block;
			flex-shrink: 0;
		}

		.version-up-to-date {
			background: var(--color-success-status);
		}

		.version-okay {
			background: #17a2b8;
		}

		.version-outdated {
			background: var(--color-warning);
		}

		.version-very-outdated {
			background: var(--color-error);
		}

		.version-unknown {
			background: var(--color-status-gone);
			opacity: 0.5;
		}

		.legend {
			display: flex;
			flex-wrap: wrap;
			gap: 1em;
			margin-top: 1em;
			font-size: 0.85em;
		}

		.legend-item {
			display: flex;
			align-items: center;
			gap: 0.5em;
		}

		.legend-label {
			color: var(--color-text-secondary);
		}

		@media (max-width: 768px) {
			.legend {
				flex-direction: column;
				font-size: 1em;
				opacity: 0.7;
				gap: 0.75em;
			}
		}
	</style>
</head>
<body>
	<div class="container">
		<div class="page-header">
			<h1>Production Server Versions</h1>
			<p>Latest version: <a class="version-text" href="/versions/{{ latest_version }}">{{ latest_version }}</a>
		</div>
		<div class="servers-grid">
			{% for server in servers %}
			<div class="server-card">
				<a href="{{ server.host }}" class="host-link" target="_blank" title="{{ server.host }}">üåê</a>
				<h3 class="server-name">{{ server.name }}</h3>
				{% if server.version %}
				<div class="version-container">
					<span class="version-display">
						<a class="version-text" href="/versions/{{ server.version }}">{{ server.version }}</a>
						{% if server.version_distance == 0 %}
							<span class="version-indicator version-up-to-date" title="Up to date"></span>
						{% elif server.version_distance < 2 %}
							<span class="version-indicator version-up-to-date" title="{{ server.version_distance }} versions behind"></span>
						{% elif server.version_distance < 5 %}
							<span class="version-indicator version-okay" title="{{ server.version_distance }} versions behind"></span>
						{% elif server.version_distance < 10 %}
							<span class="version-indicator version-outdated" title="{{ server.version_distance }} versions behind"></span>
						{% else %}
							<span class="version-indicator version-very-outdated" title="{{ server.version_distance }} versions behind"></span>
						{% endif %}
					</span>
				</div>
				{% else %}
				<div class="version-container">
					<span class="version-display">
					  <span class="version-text">Version unknown</span>
					</span>
				</div>
				{% endif %}
			</div>
			{% endfor %}
		</div>
		<div class="legend version-legend">
			<span class="legend-item">
				<span class="version-indicator version-up-to-date"></span>
				<span class="legend-label">Up to date</span>
			</span>
			<span class="legend-item">
				<span class="version-indicator version-okay"></span>
				<span class="legend-label">2-4 versions behind</span>
			</span>
			<span class="legend-item">
				<span class="version-indicator version-outdated"></span>
				<span class="legend-label">5-9 versions behind</span>
			</span>
			<span class="legend-item">
				<span class="version-indicator version-very-outdated"></span>
				<span class="legend-label">10+ versions behind</span>
			</span>
		</div>

		{% if rc_environments %}
		<div class="page-header" style="margin-top: 3em;">
			<h1>RC</h1>
		</div>
		<div class="rc-grid">
			{% for env in rc_environments %}
			<div class="rc-column">
				<div class="rc-column-header">{{ env.major }}.{{ env.minor }}</div>
				<a href="{{ env.central }}" class="rc-card" target="_blank" title="{{ env.central }}">Central</a>
				{% if env.patient %}
				<a href="{{ env.patient }}" class="rc-card" target="_blank" title="{{ env.patient }}">Patient</a>
				{% endif %}
				{% if env.facility_1 %}
				<a href="{{ env.facility_1 }}" class="rc-card" target="_blank" title="{{ env.facility_1 }}">Facility 1</a>
				{% endif %}
				{% if env.facility_2 %}
				<a href="{{ env.facility_2 }}" class="rc-card" target="_blank" title="{{ env.facility_2 }}">Facility 2</a>
				{% endif %}
				<a href="/versions/{{ env.major }}.{{ env.minor }}/mobile" class="rc-card">Mobile</a>
			</div>
			{% endfor %}
		</div>
		{% endif %}
	</div>
</body>
</html>
