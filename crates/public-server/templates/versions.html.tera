<!DOCTYPE html>
<html data-theme="light">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" type="image/svg+xml" href="/static/images/favicon.svg" />
    <title>Tamanu Versions</title>
    <link rel="stylesheet" href="/static/bulma/bulma.min.css">
    <link rel="stylesheet" href="/static/private/main.css">
    <link rel="stylesheet" href="/static/private/versions.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-link {
            text-decoration: none;
        }

        .no-versions {
            padding: 2rem;
            text-align: center;
            color: #7a7a7a;
            font-style: italic;
        }
    </style>
</head>
<body>
    <section class="hero is-light">
        <div class="hero-body">
            <div class="container">
                <div class="header-section">
                    <h1 class="title">Tamanu Versions</h1>
                    <a href="{{ env.STATUS_PAGE_URL | default(value="/status") }}" class="button">
                        Server statuses
                    </a>
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            {% if groups %}
                {% for group in groups %}
                <details class="box minor-version-group monospace">
                    <summary class="level">
                        <div class="level-left">
                            <div class="group-version">
                                {{ group.major }}.<span class="version-minor">{{ group.minor }}</span>.<span class="version-patch">{{ group.latest_patch }}</span>
                            </div>
                        </div>
                        <div class="level-right">
                            <div class="group-details">
                                <p>{{ group.count }} version{% if group.count != 1 %}s{% endif %}</p>
                                <p>{{ group.first_created_at }}</p>
                            </div>
                        </div>
                    </summary>
                    <div class="minor-versions">
                        {% for version in group.versions %}
                        <a href="/versions/{{ version.major }}.{{ version.minor }}.{{ version.patch }}" class="level box minor-version">
                            <div class="level-left">
                                <div class="level-item grouped-version">
                                    {{ version.major }}.<span class="version-minor">{{ version.minor }}</span>.<span class="version-patch">{{ version.patch }}</span>
                                </div>
                            </div>
                            <div class="level-right">
                                <div class="level-item">{{ version.created_at }}</div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                </details>
                {% endfor %}
            {% else %}
                <div class="no-versions">
                    No versions available
                </div>
            {% endif %}
        </div>
    </section>

    <script>
        // Collapse all groups on page load (progressive enhancement)
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.minor-version-group').forEach(function(group) {
                group.open = false;
            });
        });
    </script>
</body>
</html>
